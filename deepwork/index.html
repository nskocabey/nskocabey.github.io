<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Tilt Timer</title>
    <style>
        body {
            margin: 0;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            background-color: #000;
            color: #fff;
            overflow: hidden;
            user-select: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100vw;
            height: 100vh;
        }
        
        #display {
            position: relative;
            top: -15vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Courier New', monospace;
            font-size: 40px;
            font-weight: 700;
            transition: opacity 0.1s;
        }
        
        #tiltValue {
            margin-right: 10px;
        }
        
        #separator {
            margin: 0 10px;
        }
        
        #timer {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div id="display">
        <span id="tiltValue">0</span>
        <span id="separator">|</span>
        <span id="timer">00:00</span>
    </div>

    <script>
        const display = {
            tilt: document.getElementById('tiltValue'),
            timer: document.getElementById('timer'),
            element: document.getElementById('display'),
            visible: true,
            toggle() {
                this.visible = !this.visible;
                this.element.style.opacity = this.visible ? '1' : '0';
            }
        };
        
        const timer = {
            active: false,
            start: null,
            interval: null,
            checkTimeout: null,
            
            start() {
                this.active = true;
                this.start = Date.now();
                this.interval = setInterval(() => this.update(), 1000);
            },
            
            stop() {
                this.active = false;
                clearInterval(this.interval);
                this.interval = null;
                display.timer.textContent = '00:00';
            },
            
            update() {
                if (!this.active || !this.start) return;
                
                const elapsed = Math.floor((Date.now() - this.start) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                
                display.timer.textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        };
        
        function initTiltTracking() {
            window.addEventListener('deviceorientation', e => {
                if (!e.beta) return;
                
                const tilt = Math.round(e.beta);
                const angle = tilt < 0 ? 0 : (tilt > 90 ? 90 : tilt);
                display.tilt.textContent = angle;
                
                // Check if tilt is in target range (10-25 degrees)
                if (angle >= 10 && angle <= 25) {
                    // Start countdown to activate timer
                    if (!timer.active && !timer.checkTimeout) {
                        timer.checkTimeout = setTimeout(() => {
                            timer.start();
                            timer.checkTimeout = null;
                        }, 5000);
                    }
                } else {
                    // Clear activation countdown if tilt leaves range
                    if (timer.checkTimeout) {
                        clearTimeout(timer.checkTimeout);
                        timer.checkTimeout = null;
                    }
                    
                    // Stop timer if running
                    if (timer.active) {
                        timer.stop();
                    }
                }
            });
        }
        
        function requestOrientationPermission() {
            if (typeof DeviceOrientationEvent?.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(result => {
                        if (result === 'granted') {
                            initTiltTracking();
                        }
                    })
                    .catch(console.error);
            } else {
                initTiltTracking();
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            let permissionRequested = false;
            
            document.body.addEventListener('click', e => {
                if (!permissionRequested) {
                    requestOrientationPermission();
                    permissionRequested = true;
                    return;
                }
                
                display.toggle();
                e.preventDefault();
            });
        });
    </script>
</body>
</html>